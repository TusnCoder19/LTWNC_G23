@model G23NHNT.Models.HomeViewModel
@{
    ViewData["Title"] = "Trang Chủ";
}

<link rel="stylesheet" href="~/css/index.css" asp-append-version="true" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="container-fluid mt-3">
    <div class="d-flex justify-content-start mb-4">
        <button class="btn btn-primary mr-2">Danh mục</button>
        @if (!User.Identity.IsAuthenticated || Model.IsChuTro)
        {
            <a asp-action="Create" asp-controller="House" class="btn btn-primary mr-2" style="margin-left: 10px;">
                Cung cấp thông tin nhà trọ
            </a>
            <a asp-action="ListHouseRoom" asp-controller="QuanLi" asp-route-userId="@ViewBag.userId" class="btn btn-primary mr-2"
               style="margin-left: 10px;">
                Quản lí bài đăng
            </a>
        }
    </div>
    <div class="row">
        <!-- Left Side: Filter Section -->
        <div class="col-md-3">
            <div class="filter-section p-3 bg-light">
                <h5>Bộ lọc</h5>
                <form method="get" action="@Url.Action("Index", "Home")">
                    <!-- Price Filter -->
                    <div class="mb-3">
                        <label for="priceRange" class="form-label">Giá</label>
                        <select class="form-control" id="priceRange" name="priceRange">
                            <!option value="">Tất cả</!option>
                            <!option value="0-1000000" @((ViewBag.PriceRange == "0-1000000") ? "selected" : "")>Dưới 1 triệu</!option>
                            <!option value="1000000-3000000" @((ViewBag.PriceRange == "1000000-3000000") ? "selected" : "")>1-3 triệu</!option>
                            <!option value="3000000-5000000" @((ViewBag.PriceRange == "3000000-5000000") ? "selected" : "")>3-5 triệu</!option>
                            <!option value="5000000-10000000" @((ViewBag.PriceRange == "5000000-10000000") ? "selected" : "")>5-10 triệu</!option>
                            <!option value="10000000" @((ViewBag.PriceRange == "10000000") ? "selected" : "")>Trên 10 triệu</!option>
                        </select>


                    </div>

                    <!-- Sort Filter -->
                    <div class="mb-3">
                        <label for="sortBy" class="form-label">Sắp xếp theo</label>
                        <select class="form-control" id="sortBy" name="sortBy">
                            <!option value="newest" @((ViewBag.SortBy == "newest") ? "selected" : "")>Mới nhất</!option>
                            <!option value="priceLowHigh" @((ViewBag.SortBy == "priceLowHigh") ? "selected" : "")>Giá: Thấp đến Cao</!option>
                            <!option value="priceHighLow" @((ViewBag.SortBy == "priceHighLow") ? "selected" : "")>Giá: Cao đến Thấp</!option>
                        </select>

                    </div>

                    <!-- Room Type Filter -->
                    <div class="mb-3">
                        <label for="roomType" class="form-label">Loại phòng</label>
                        <select class="form-control" id="roomType" name="roomType">
                            <option value="">Tất cả</option>
                            @foreach (var houseType in Model.HouseTypes)
                            {
                                <!option value="@houseType.Value" @((ViewBag.RoomType == houseType.Value) ? "selected" : "")>@houseType.Text</!option>
                            }
                        </select>
                    </div>

                    <!-- Amenities Filter -->
                    <div class="mb-3">
                        <label for="amenities" class="form-label">Tiện nghi</label>
                        @foreach (var amenity in Model.Amenities)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="amenities" value="@amenity.Name"
                                       @(ViewBag.SelectedAmenities != null && ViewBag.SelectedAmenities.Contains(amenity.Name) ? "checked" : "")>
                                <label class="form-check-label">@amenity.Name</label>
                            </div>
                        }
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-danger w-100">Áp dụng</button>
                </form>
            </div>
        </div>

        <!-- Right Side: House List -->
        <div class="col-md-9">
            <div class="d-flex justify-content-start mb-4">
                <!-- Existing search bar -->
                @using (Html.BeginForm("Index", "Home", FormMethod.Get, new { @class = "form-inline w-100" }))
                {
                    <div class="form-group  w-100">
                        <label>Tìm kiếm: </label>
                        <input type="Text" class="form-control mx-sm-3 flex-grow-1" value="@ViewBag.Keyword" name="searchString" placeholder="Tìm kiếm địa điểm, quận, tên đường,..">
                        <input type="submit" class="btn btn-danger" value="Search">
                    </div>
                }
            </div>

            <h2>Danh Sách Nhà Trọ</h2>
            <div class="container-body" style="max-height: 600px; overflow-y: auto; padding-right: 10px;">
                @foreach (var house in Model.Houses)
                {
                    <div class="row mb-4 align-items-center">
                        <!-- Image Section -->
                        <div class="col-auto">
                            <img src="@house.HouseDetails.FirstOrDefault()?.Image" alt="@house.NameHouse" class="img-fluid rounded"
                                 style="width: 160px; height: 180px; object-fit: cover;">
                        </div>

                        <!-- Information Section -->
                        <div class="col-md-8">
                            <h5 class="font-weight-bold text-primary">@house.NameHouse</h5>
                            <p class="mb-1">
                                <strong class="text-dark">Địa chỉ:</strong>
                                <span class="text-secondary">@house.HouseDetails.FirstOrDefault()?.Address</span>
                            </p>
                            <p class="mb-1">
                                <strong class="text-dark">Giá nhà:</strong>
                                <span class="text-success">
                                    @house.HouseDetails.FirstOrDefault()?.Price.ToString("#,0", new
     System.Globalization.CultureInfo("vi-VN")) VND
                                </span>
                            </p>
                            <p class="mb-1">
                                <strong class="text-dark">Diện tích:</strong>
                                <span class="text-secondary">@house.HouseDetails.FirstOrDefault()?.DienTich m²</span>
                            </p>
                            <p class="mb-1">
                                <strong class="text-dark">Ngày đăng:</strong>
                                <span class="text-secondary">@house.HouseDetails.FirstOrDefault()?.TimePost.ToString("dd/MM/yyyy")</span>
                            </p>
                            <a asp-controller="Home" asp-action="Detail" asp-route-id="@house.IdHouse"
                               asp-route-type="house" class="btn btn-primary mt-2">
                                <i class="fas fa-eye"></i> Xem Chi Tiết
                            </a>
                        </div>
                    </div>
                    <hr>
                }
            </div>
        </div>

    </div>
</div>

<script>function promptLogin(loginUrl) {
        alert("Bạn cần đăng nhập với tư cách là chủ trọ để đăng bài.");
        window.location.href = loginUrl;
    }</script>
